<?php

$pw = "griefreturns";

session_start();
if ($_SERVER["REQUEST_METHOD"] == "GET" && $_GET["logout"] == "1") {
    session_destroy();
    header('Location: adm.php');
    die();
}
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    if ($_POST["pw"]==$pw) {
        $_SESSION["loggedin"] = true;
    }
}
if (!isset($_SESSION["loggedin"])) {
?>
<!DOCTYPE html>
<html lang="en">
<head>
<style>
table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
  padding: 5px;
}
</head>
</style>
<body>
<form action="adm.php" id="form" method="post">
  <input type="password" name="pw" value="">
  <input type="submit" value="login">
</form>
</body>
</html>
<?php
die();
}

?>
<h3>luctus' panel</h3>
<a href="edit.php?serverip=main.lua">edit main.lua</a>
<br><br>
<table>
<tr><th>serverip</th><th>last access / edit</th><th>edit</th></tr>
<?php
clearstatcache();
$dir = getcwd()."/servers";
$files = array_diff(scandir($dir), array("..",".","index.html"));
$array = array();
foreach($files as $file) {
    $name = $dir."/".$file;
    $array[filemtime($name)] = pathinfo($file, PATHINFO_FILENAME);
}
krsort($array);
foreach($array as $date => $name) {
    echo "<tr><td>".$name."</td><td>".date("Y-m-d H:i:s", $date)."</td>";
    echo "<td><a href='edit.php?serverip=".$name."'>edit</td></tr>";
}
?>
</table>
<br><br>
<a href="adm.php?logout=1">logout</a>
</body>
</html>
