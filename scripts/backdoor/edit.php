<?php
session_start();
if (!isset($_SESSION["loggedin"])) {
    header('Location: adm.php');
    die();
}
$textarea = "--";
$message = "";
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $serverip = $_POST["serverip"];
    $content = $_POST["content"];

    if (empty($serverip) || empty($content)) {
        die("name or file content can not be empty");
    }
    $sfile = getcwd()."/servers/".$serverip.".txt";
    if ($serverip == "main.lua") {
        $sfile = $serverip;
    }
    if (!file_exists($sfile)) {
        die("server ip doesnt exist in files");
    }
    file_put_contents($sfile,$content);
    header("Location: adm.php");
    die();
}else{
    $sfile = getcwd()."/servers/".$_GET["serverip"].".txt";
    if (file_exists($sfile)) {
        $textarea = file_get_contents($sfile);
    }
    if ($_GET["serverip"] == "main.lua") {
        if (file_exists($_GET["serverip"])) {
        $textarea = file_get_contents($_GET["serverip"]);
    }
    }
}
?>
<!DOCTYPE html>
<html lang="en">
<head>

</head>
<body>
<h3><?php echo $message; ?></h3>
<form action="edit.php" id="form" method="post">
  <input type="text" name="serverip" value="<?php echo $_GET["serverip"]; ?>">
  <input type="submit" value="Save">
</form>
<br>
<textarea rows="8" cols="50" name="content" form="form">
<?php echo $textarea; ?></textarea>
</body>
</html>
